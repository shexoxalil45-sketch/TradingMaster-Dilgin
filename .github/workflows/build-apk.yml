name: Android CI/CD

on: push: branches: - main pull_request: branches: - main workflow_dispatch:

jobs: build-release: runs-on: ubuntu-latest

steps:
  - name: Checkout code
    uses: actions/checkout@v4

  - name: Set up JDK
    uses: actions/setup-java@v4
    with:
      distribution: temurin
      java-version: 17

  - name: Set up Flutter
    uses: subosito/flutter-action@v2
    with:
      channel: stable

  - name: Install dependencies
    run: flutter pub get

  - name: Build APK (release)
    run: flutter build apk --release

  - name: Build AAB (release)
    run: flutter build appbundle --release

  - name: Sign APK & AAB
    uses: r0adkll/sign-android-release@v1
    with:
      releaseDirectory: build/app/outputs
    env:
      SIGNING_KEY: ${{ secrets.ANDROID_KEYSTORE_BASE64 }}
      ALIAS: ${{ secrets.ANDROID_KEY_ALIAS }}
      KEY_STORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
      KEY_PASSWORD: ${{ secrets.ANDROID_KEY_PASSWORD }}

  - name: Upload artifacts
    uses: actions/upload-artifact@v4
    with:
      name: SmartTrading-Android-Builds
      path: |
        build/app/outputs/**/*.apk
        build/app/outputs/**/*.aab

send-notification: runs-on: ubuntu-latest needs: build-release

steps:
  - name: Notify success
    run: echo "Build completed successfully!"
